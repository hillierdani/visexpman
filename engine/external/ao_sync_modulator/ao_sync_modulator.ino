/*At 100 Hz checkerboard scanning 1/(100 * 48 ) -> min 200 us pulses 
 * are generated by ao. Therefore 60-100 us delay should be well detectable.
 * 
 * 
 * */
 
#define DELAY 100
#define SYNCIN 3
#define SYNCOUT 4
byte syncin;

ISR(INT1_vect) {
  cli();
  syncin=PIND&(1<<SYNCIN);
  if (syncin!=0)
  {
    delayMicroseconds(DELAY);
    PORTD|=1<<SYNCOUT;
  }
  else
  {
    PORTD&=~(1<<SYNCOUT);
  }
  
  
  
  sei();
}


void setup() {
  DDRD&=~(1<<SYNCIN);//int1
  DDRD|=(1<<SYNCOUT);
  EICRA|=1<<2;//falling edges
  EIMSK|=2;
  sei();
  
}

void loop() {
  /*PORTD|=1<<SYNCOUT;//stim led on
  PORTD|=1<<SYNCIN;//stim led on
  delayMicroseconds(100);
  PORTD&=~(1<<SYNCOUT);//stim led off
  PORTD&=~(1<<SYNCIN);//stim led off
  delayMicroseconds(100);*/

}
